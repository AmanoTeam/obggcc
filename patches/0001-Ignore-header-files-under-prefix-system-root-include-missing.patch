From 3fb0b30a7cdfe6dcdf7553e82fa9f58375a5ee39 Mon Sep 17 00:00:00 2001
From: Kartatz <105828205+Kartatz@users.noreply.github.com>
Date: Mon, 22 Dec 2025 23:40:06 -0300
Subject: [PATCH] Ignore header files under
 (prefix)/(system-root)/include-missing
MIME-Version: 1.0
Content-Type: text/plain; charset=UTF-8
Content-Transfer-Encoding: 8bit

These header files are not meant to be included. They exist to prevent projects from trying to include headers from the host C library when using OBGGCC_SYSTEM_LIBRARIES and the requested header does not exist within the cross-compilerâ€™s system root. This is done so projects do not accidentally use features that are not available in the specific glibc version they are being cross-compiled against.
---
 libcpp/files.cc | 28 +++++++++++++++++++++++-----
 1 file changed, 23 insertions(+), 5 deletions(-)

diff --git a/libcpp/files.cc b/libcpp/files.cc
index d80c4bfd9..90c31301f 100644
--- a/libcpp/files.cc
+++ b/libcpp/files.cc
@@ -435,8 +435,15 @@ find_file_in_dir (cpp_reader *pfile, _cpp_file *file, bool *invalid_pch,
       if (!file->embed && pch_open_file (pfile, file, invalid_pch))
 	return true;
 
-      if (open_file (file))
-	return true;
+      if (open_file (file)) {
+        if (strstr(path, "include-missing") != NULL) {
+          close(file->fd);
+          file->err_no = 676767;
+          return false;
+        }
+        
+        return true;
+      }
 
       if (file->err_no != ENOENT)
 	{
@@ -524,7 +531,8 @@ _cpp_find_file (cpp_reader *pfile, const char *fname, cpp_dir *start_dir,
   bool saw_embed_include = false;
   struct cpp_dir *found_in_cache = NULL;
   bool is_embed = kind == _cpp_FFK_EMBED || kind == _cpp_FFK_HAS_EMBED;
-
+  bool ignore = false;
+  
   /* Ensure we get no confusion between cached files and directories.  */
   if (start_dir == NULL)
     cpp_error_at (pfile, CPP_DL_ICE, loc, "NULL directory in %<find_file%>");
@@ -560,8 +568,17 @@ _cpp_find_file (cpp_reader *pfile, const char *fname, cpp_dir *start_dir,
     /* Try each path in the include chain.  */
     for (;;)
       {
-	if (find_file_in_dir (pfile, file, &invalid_pch, loc))
-	  break;
+      if (!ignore) {
+        if (find_file_in_dir (pfile, file, &invalid_pch, loc)) {
+            break;
+        }
+        
+    	ignore = (file->err_no == 676767);
+      }
+
+    if (ignore) {
+        file->err_no = ENOENT;
+    }
 
 	if (is_embed
 	    && file->dir == start_dir
@@ -570,6 +587,7 @@ _cpp_find_file (cpp_reader *pfile, const char *fname, cpp_dir *start_dir,
 	  file->dir = pfile->embed_include;
 	else
 	  file->dir = file->dir->next;
+	
 	if (file->dir == NULL)
 	  {
 	    if (!is_embed
-- 
2.51.2

