From 163059d181b90938dabd6c8374acb0f2c00398ee Mon Sep 17 00:00:00 2001
From: Kartatz <105828205+Kartatz@users.noreply.github.com>
Date: Sat, 11 Oct 2025 16:33:41 -0300
Subject: [PATCH] Revert "x86: Fixes for AMD znver5 enablement"

This reverts commit 578c322e7d6a6b5e392d7b587179e3031b7a8daa.
---
 gcc/common/config/i386/cpuinfo.h | 12 +-----------
 gcc/config/i386/cpuid.h          |  4 ----
 2 files changed, 1 insertion(+), 15 deletions(-)

diff --git a/gcc/common/config/i386/cpuinfo.h b/gcc/common/config/i386/cpuinfo.h
index 3f29f17e2..c93ea0723 100644
--- a/gcc/common/config/i386/cpuinfo.h
+++ b/gcc/common/config/i386/cpuinfo.h
@@ -312,8 +312,7 @@ get_amd_cpu (struct __processor_model *cpu_model,
       break;
     case 0x1a:
       cpu_model->__cpu_type = AMDFAM1AH;
-      if (model <= 0x4f || (model >= 0x60 && model <= 0x77) ||
-	  (model >= 0xd0 && model <= 0xd7))
+      if (model <= 0x77)
 	{
 	  cpu = "znver5";
 	  CHECK___builtin_cpu_is ("znver5");
@@ -1103,15 +1102,6 @@ get_available_features (struct __processor_model *cpu_model,
 	set_feature (FEATURE_WBNOINVD);
     }
 
-  if (ext_level >= 0x80000021)
-    {
-      __cpuid (0x80000021, eax, ebx, ecx, edx);
-      if (eax & bit_AMD_PREFETCHI)
-	{
-	  set_feature (FEATURE_PREFETCHI);
-	}
-    }
-
 #undef set_feature
 }
 
diff --git a/gcc/config/i386/cpuid.h b/gcc/config/i386/cpuid.h
index 25e28352f..afd4ef06e 100644
--- a/gcc/config/i386/cpuid.h
+++ b/gcc/config/i386/cpuid.h
@@ -72,10 +72,6 @@
 #define bit_CLZERO	(1 << 0)
 #define bit_WBNOINVD	(1 << 9)
 
-/* Extended Features (%eax == 0x80000021) */
-/* %eax */
-#define bit_AMD_PREFETCHI (1 << 20)
-
 /* Extended Features Leaf (%eax == 7, %ecx == 0) */
 /* %ebx */
 #define bit_FSGSBASE	(1 << 0)
-- 
2.50.1

