From cc6d092aabb3dfc45b71b66a1a6204b9076b1188 Mon Sep 17 00:00:00 2001
From: Kartatz <105828205+Kartatz@users.noreply.github.com>
Date: Wed, 11 Feb 2026 03:53:06 -0300
Subject: [PATCH] Workaround mold linker issue
MIME-Version: 1.0
Content-Type: text/plain; charset=UTF-8
Content-Transfer-Encoding: 8bit

mold does not fully support the linker script syntax used by GCCâ€™s internal *_asneeded libraries (-latomic_asneeded, -lrt_asneeded).
---
 libatomic_asneeded.so | 2 +-
 libgcc_s_asneeded.so  | 2 +-
 librt_asneeded.so     | 2 +-
 3 files changed, 3 insertions(+), 3 deletions(-)

diff --git a/libatomic_asneeded.so b/libatomic_asneeded.so
index 3263af4..56f78d2 100644
--- a/libatomic_asneeded.so
+++ b/libatomic_asneeded.so
@@ -1,3 +1,3 @@
 /* GNU ld script
    Add DT_NEEDED entry for -latomic only if needed.  */
-INPUT ( AS_NEEDED ( -latomic ) )
+INPUT ( -lc AS_NEEDED ( -latomic ) )
diff --git a/libgcc_s_asneeded.so b/libgcc_s_asneeded.so
index 2289acb..8b81bc8 100644
--- a/libgcc_s_asneeded.so
+++ b/libgcc_s_asneeded.so
@@ -1,3 +1,3 @@
 /* GNU ld script
    Add DT_NEEDED entry for libgcc_s.so only if needed.  */
-INPUT ( AS_NEEDED ( -lgcc_s ) )
+INPUT ( -lc AS_NEEDED ( -lgcc_s ) )
diff --git a/librt_asneeded.so b/librt_asneeded.so
index 8123a60..346916b 100644
--- a/librt_asneeded.so
+++ b/librt_asneeded.so
@@ -1,3 +1,3 @@
 /* GNU ld script
    Add DT_NEEDED entry for -lrt only if needed.  */
-INPUT ( AS_NEEDED ( -lrt ) )
+INPUT ( -lc AS_NEEDED ( -lrt ) )
-- 
2.52.0

